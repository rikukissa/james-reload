var __slice=[].slice;module.exports=function(e){var r,n,t,o,u,i,s,c,a,l;return null==e&&(e={}),u=require("fs"),i=require("http"),l=require("websocket").server,t=require("colors"),e.proxyPort=e.proxyPort||e.reload||9002,e.srcPort=e.srcPort||e.proxy||9001,e.keepReconnecting=e.keepReconnecting||!0,e.reloadAfterReconnect=e.reloadAfterReconnect||!0,e.debug=e.debug||!1,n=(""+u.readFileSync(__dirname+"/client.js")).replace("__opts__",JSON.stringify(e)),r=function(e){return e.replace("</body>","<script>"+n+"</script></body>")},s=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],console.log.apply(console,["James-reload:"].concat(e))},a=i.createServer(function(n,t){var o;return o=function(){var u;return u=i.request({hostname:"localhost",port:e.srcPort,method:n.method,path:n.url,headers:n.headers},function(e){var n,o,u;return n=e.headers["content-type"],u=(null!=n?n.toLowerCase().indexOf("text/html"):void 0)>-1,o="",e.on("data",function(e){return u?o+=e:t.write(e,"binary")}),e.on("end",function(){return u?t.end(r(o),"utf-8"):t.end()}),u?void 0:t.writeHead(e.statusCode,e.headers)}),n.on("data",function(e){return u.write(e)}),n.on("end",function(){return u.end()}),u.on("error",function(r){return s("Proxy request failed:".red,r.message),e.keepReconnecting?(s("Reconnecting".yellow),o()):void 0})},o()}),a.listen(e.proxyPort),l=new l({httpServer:a,autoAcceptConnections:!1}),o=[],l.on("request",function(e){var r;return r=e.accept(null,e.origin),o.push(r),r.on("close",function(){return o.splice(o.indexOf(r),1)})}),c=function(e){var r,n,t,u;for(null==e&&(e={}),e.stylesheetsOnly=e.stylesheetsOnly||!1,n=e.stylesheetsOnly?"refresh":"reload",t=0,u=o.length;u>t;t++)r=o[t],r.sendUTF(n);return s(n.green)}};