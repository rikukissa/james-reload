var __slice=[].slice;module.exports=function(e){var r,n,t,o,c,s,u,i,l,a;return null==e&&(e={}),c=require("fs"),s=require("http"),a=require("websocket").server,t=require("colors"),e.proxyPort=e.proxyPort||e.reload||9002,e.srcPort=e.srcPort||e.proxy||9001,e.keepReconnecting=e.keepReconnecting||!0,e.reloadAfterReconnect=e.reloadAfterReconnect||!0,e.debug=e.debug||!1,n=(""+c.readFileSync(__dirname+"/client.js")).replace("__opts__",JSON.stringify(e)),r=function(e){return e.replace("</body>","<script>"+n+"</script></body>")},u=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],console.log.apply(console,["James-reload:"].concat(e))},l=s.createServer(function(n,t){var o;return o=function(){var o;return o=s.request({hostname:"localhost",port:e.srcPort,method:n.method,path:n.url,headers:n.headers},function(e){var n,o,c;return n=e.headers["content-type"],c=(null!=n?n.toLowerCase().indexOf("text/html"):void 0)>-1,o="",e.on("data",function(e){return c?o+=e:t.write(e,"binary")}),e.on("end",function(){return c?t.end(r(o),"utf-8"):t.end()}),c?void 0:t.writeHead(e.statusCode,e.headers)}),n.on("data",function(e){return o.write(e)}),n.on("end",function(){return o.end()}),o.on("error",function(){}),o.on("socket",function(e){return e.setTimeout(2e3),e.on("timeout",function(){return o.abort()})})},o()}),l.listen(e.proxyPort),a=new a({httpServer:l,autoAcceptConnections:!1}),o=[],a.on("request",function(e){var r;return r=e.accept(null,e.origin),o.push(r),r.on("close",function(){return o.splice(o.indexOf(r),1)})}),i=function(e){var r,n,t,c;for(null==e&&(e={}),e.stylesheetsOnly=e.stylesheetsOnly||!1,n=e.stylesheetsOnly?"refresh":"reload",t=0,c=o.length;c>t;t++)r=o[t],r.sendUTF(n);return u(n.green)}};