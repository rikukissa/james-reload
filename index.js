module.exports=function(e){var t,r,n,o,u,i,s,a,c;return u=require("fs"),i=require("http"),t=require("websocket").server,n=(""+u.readFileSync(__dirname+"/client.js")).replace("__opts__",JSON.stringify(e)),r=function(e){return e.replace("</body>","<script>"+n+"</script></body>")},a=i.createServer(function(t,n){var o;return o=function(){var u;return u=i.request({hostname:"localhost",port:e.proxy,method:t.method,path:t.url,headers:t.headers},function(e){var t,o,u;return t=e.headers["content-type"],u=(null!=t?t.toLowerCase().indexOf("text/html"):void 0)>-1,o="",e.on("data",function(e){return u?o+=e:n.write(e,"binary")}),e.on("end",function(){return u?n.end(r(o),"utf-8"):n.end()}),u?void 0:n.writeHead(e.statusCode,e.headers)}),t.on("data",function(e){return u.write(e)}),t.on("end",function(){return u.end()}),u.on("error",o)},o()}),a.listen(e.reload),c=new t({httpServer:a,autoAcceptConnections:!1}),o=[],c.on("request",function(e){var t;return t=e.accept(null,e.origin),o.push(t),t.on("close",function(){return o.splice(o.indexOf(t),1)})}),s=function(e){var t,r,n,u;for(null==e&&(e={}),e.stylesheetsOnly=e.stylesheetsOnly||!1,u=[],r=0,n=o.length;n>r;r++)t=o[r],u.push(t.sendUTF(e.stylesheetsOnly?"refresh":"reload"));return u}};