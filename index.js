var __slice=[].slice;module.exports=function(e){var t,r,n,o,u,i,c,a,l,s;return null==e&&(e={}),u=require("fs"),i=require("http"),s=require("websocket").server,n=require("colors"),e.proxyPort=e.proxyPort||e.reload||9002,e.srcPort=e.srcPort||e.proxy||9001,e.keepReconnecting=e.keepReconnecting||!0,e.reloadAfterReconnect=e.reloadAfterReconnect||!0,e.debug=e.debug||!1,r=(""+u.readFileSync(__dirname+"/client.js")).replace("__opts__",JSON.stringify(e)),t=function(e){return e.replace("</body>","<script>"+r+"</script></body>")},c=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],console.log.apply(console,["James-reload:"].concat(e))},l=i.createServer(function(r,n){var o;return o=function(){var o;return o=i.request({hostname:"localhost",port:e.srcPort,method:r.method,path:r.url,headers:r.headers},function(e){var r,o,u,i,c;return r=e.headers["content-type"],u=(null!=r?r.toLowerCase().indexOf("text/html"):void 0)>-1,i=302===(c=e.statusCode)||307===c,o="",e.on("data",function(e){return u?o+=e:n.write(e,"binary")}),e.on("end",function(){return u?n.end(t(o),"utf-8"):n.end()}),i||!u?n.writeHead(e.statusCode,e.headers):void 0}),r.on("data",function(e){return o.write(e)}),r.on("end",function(){return o.end()}),o.on("error",function(){}),o.on("socket",function(e){return e.setTimeout(2e3),e.on("timeout",function(){return o.abort()})})},o()}),l.listen(e.proxyPort),s=new s({httpServer:l,autoAcceptConnections:!1}),o=[],s.on("request",function(e){var t;return t=e.accept(null,e.origin),o.push(t),t.on("close",function(){return o.splice(o.indexOf(t),1)})}),a=function(e){var t,r,n,u;for(null==e&&(e={}),e.stylesheetsOnly=e.stylesheetsOnly||!1,r=e.stylesheetsOnly?"refresh":"reload",n=0,u=o.length;u>n;n++)t=o[n],t.sendUTF(r);return c(r.green)}};